<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>General Discussion - GameHub Forum</title>
  <link rel="stylesheet" href="/static/general.css" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <a href="/homePage" class="logo">🎮 GameHub</a>
        <div class="nav-categories">
          <a href="/homePage" class="nav-btn home-btn">All Posts</a>
          <a href="/category/general" class="nav-btn category-btn active">💬 General</a>
          <a href="/category/online" class="nav-btn category-btn">🌐 Online</a>
          <a href="/category/story" class="nav-btn category-btn">📖 Story</a>
          <a href="/category/souls" class="nav-btn category-btn">⚔️ Souls</a>
          <a href="/category/minecraft" class="nav-btn category-btn">⛏️ Minecraft</a>
          <a href="/about" class="nav-btn category-btn">ℹ️ About</a>
        </div>
      </div>
      <div class="nav-right">
        {{if .UserID}}
          <!-- Logged in user -->
          <a href="/profile?id={{.UserID}}" class="create-btn">👤</a>
          <a href="/createpost" class="create-btn">✨ Create Post</a>
          <form method="POST" action="/logout" class="logout-form">
            <button type="submit" class="logout-btn">🚪 Logout</button>
          </form>
        {{else}}
          <!-- Guest user -->
          <a href="/register" class="create-btn">📝 Register</a>
          <a href="/login" class="logout-btn">🔑 Login</a>
        {{end}}
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="content-container">
      <div class="content-header">
        <h1 class="page-title">💬 General Discussion</h1>
        <p class="page-subtitle">Open discussions about gaming, life, and everything in between</p>
      </div>

      <div class="posts-grid">
        {{if .Posts}}
          {{range .Posts}}
          <article class="post-card">
            <a href="/post?id={{.ID}}" class="post-link">
              <div class="post-header">
                <div class="post-author">
                  <div class="author-avatar">{{upper .Username}}</div>
                  <div class="author-info">
                    <span class="author-name">{{.Username}}</span>
                    <span class="post-time">{{.CreatedAt}}</span>
                  </div>
                </div>
                <div class="post-category">{{.Category}}</div>
              </div>

              <div class="post-content">
                <h3 class="post-title">{{.Title}}</h3>
                <p class="post-text">{{- if gt (len .Content) 150}}{{slice .Content 0 150}}...{{else}}{{.Content}}{{end -}}</p>
              </div>
            </a>

            <div class="post-actions">
              {{if $.UserID}}
                <!-- Show like/dislike buttons only for logged in users -->
                <form method="POST" action="/post/like" style="display:inline">
                  <input type="hidden" name="post_id" value="{{.ID}}" />
                  <input type="hidden" name="is_like" value="1" />
                  <button type="submit" class="action-btn like-btn {{if eq (ptrVal .UserLiked) 1}}active{{end}}">
                    👍 <span class="action-count">{{.Likes}}</span>
                  </button>
                </form>

                <form method="POST" action="/post/like" style="display:inline">
                  <input type="hidden" name="post_id" value="{{.ID}}" />
                  <input type="hidden" name="is_like" value="0" />
                  <button type="submit" class="action-btn dislike-btn {{if eq (ptrVal .UserLiked) 0}}active{{end}}">
                    👎 <span class="action-count">{{.Dislikes}}</span>
                  </button>
                </form>
              {{else}}
                <!-- Show read-only counts for guests -->
                <div class="action-btn like-btn disabled">
                  👍 <span class="action-count">{{.Likes}}</span>
                </div>
                <div class="action-btn dislike-btn disabled">
                  👎 <span class="action-count">{{.Dislikes}}</span>
                </div>
              {{end}}

              <a href="/post?id={{.ID}}" class="action-btn comment-btn">
                💬 <span class="action-count">{{.CommentsCount}}</span>
              </a>
            </div>
          </article>
          {{end}}
        {{else}}
          <div class="no-posts">
            <h3>No posts found in this category</h3>
            <p>Be the first to create a post in General Discussion!</p>
            {{if .UserID}}
              <a href="/createpost" class="create-btn">✨ Create the First Post</a>
            {{else}}
              <a href="/register" class="create-btn">📝 Register to Create Posts</a>
            {{end}}
          </div>
        {{end}}
      </div>
    </div>
  </main>
</body>
</html>